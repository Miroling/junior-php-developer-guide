# Проверка настроек

1. Расписать процесс установки Wordpress или Drupal
2. Описать тонкости при настройки в стеках LAMP и LEMP

# **Установка Wordpress**

### 1. Загрузка и распаковка
 Загрузите и распакуйте дистрибутив WordPress:
```
cd ~
wget http://wordpress.org/latest.tar.gz
```
Распакуйте дистрибутив используя:
```
tar -xzvf latest.tar.gz 
```
Дистрибутив WordPress будет распакован в папку под названием wordpress в той же самой папке (директории), в которую вы загрузили архив latest.tar.gz

Нам также нужно установить несколько дополнительных программных пакетов. Для этого выполните следующие команды:
```
sudo apt-get update
sudo apt-get install php5-gd libssh2-php
```
Теперь, нам нужно скопировать файлы WordPress в корневой каталог Nginx, откуда они могут быть предоставлены нашим посетителям.

Один из самых простых и надёжных способов переноса файлов из одной директории в другую это использование команды rsync. Данный способ сохраняет целостность данных и выставленные права доступа к папкам.

Путь к корневому каталогу следующий /var/www/ (вы можете использовать любой необходимый вам каталог). Мы можем перенести туда файлы WordPress следующей командой:
```
sudo mkdir -p /var/www/wordpress
```
```
sudo rsync -avP ~/wordpress/ /var/www/wordpress/
```
Тем самым весь контент, который был распакован ранее, будет перенесён в корневой каталог Nginx.

Теперь нам нужно перейти в эту папку, чтобы внести некоторые изменения в правах доступа.
```
cd /var/www/wordpress
```
Вам нужно будет поменять владельца наших файлов для повышения безопасности.

Мы собираемся передать права обычному пользователю с sudo привилегиями.

Мы также передадим права доступа группе www-data, которая используется веб-сервером Nginx.

Мы можем быстро назначить права доступа введя:
```
sudo chown -R 'Имя\_вашего\_пользователя':www-data *
```
Данная команда установит необходимые нам права доступа.

Нам также нужно настроить права доступа для директории, куда WordPress будет загружать изображение и разного рода контент для нашего сайта. В настоящее время права доступа слишком строгие.

В первую очередь, давайте самостоятельно создадим папку uploads внутри wp-content.

Это будет главный каталог для загружаемого контента в будущем:
```
mkdir /var/www/wordpress/wp-content/uploads
```
Однако, необходимо выдать веб-серверу разрешение на загрузку файлов в данный каталог. Сделаем это выполнив следующую команду:
```
sudo chown -R :www-data /var/www/wordpress/wp-content/uploads
```
Это позволит веб-серверу создавать файлы и директории внутри uploads, что даст нам возможность загружать контент на сервер пользуясь WordPress.
### 2. Создание базы данных и пользователя

Чтобы начать, нужно ввойти в администрирование MySQL, введя следующую команду:
```
mysql -u root -p
```
Вам будет предложено ввести пароль администратора, который вы вводили при установке MySQL. После этого появится командная строка MySQL.

Первым делом мы можем создать отдельную базу данных, которой сможет управлять WordPress. Вы можете назвать её как угодно, но в данном примере для наглядности мы назовём её wordpress. Введите следующую команду для создания базы данных:
```
CREATE DATABASE wordpress;
```
Далее мы создадим отдельную учётную запись MySQL, которую мы будем использовать исключительно для работы с новой базой данных. Создание отдельных баз данных и пользователей для каждой функции является хорошей практикой с точки зрения удобства управления и безопасности.

Мы назовём новую учётную запись wordpressuser и присвоим ей пароль password. Вам, безусловно, лучше использовать другой пароль. Точно также вы можете по желанию выбрать любое другое имя. Вот команда, которая нам нужна для создания пользователя:
```
CREATE USER wordpressuser@localhost IDENTIFIED BY 'password';
```
Теперь у нас есть база данных и пользователь, созданные специально для работы с WordPress. Однако, мы ещё не выдали права доступа пользователю на управление базой данных.

Давайте исправим это, предоставив пользователю права доступа к нашей базе данных выполнив следующую команду:
```
GRANT ALL PRIVILEGES ON wordpress.* TO wordpressuser@localhost;
```
Теперь пользователь имеет доступ к базе данных. Чтобы изменения вступили в силу, нужно выполнить следующую команду:
```
FLUSH PRIVILEGES;
```
Теперь всё готово. Мы можем выйти из командной строки MySQL введя:
```
exit
```
Теперь вы должны находиться в обычной командной строке.

### 3. Настройка WordPress
Зайдите в директорию WordPress, которую мы только что распаковали:
```
cd ~/wordpress
```
Воспользуемся стандартным файлом конфигурации, который имеется по умолчанию, скопировав его в эту же папку, но изменив название:
```
cp wp-config-sample.php wp-config.php
```
Теперь, когда у нас есть файл конфигурации, давайте откроем его в текстовом редакторе:
```
nano wp-config.php
```
Данная конфигурация подходит нам практически полностью. Единственные изменения, которые нам необходимо внести, это информацию о доступе к нашей базе данных.

Найдём в файле следующие найстройки DBNAME, DBUSER, и DB_PASSWORD, чтобы внести необходимые поправки.

Внесённые поправки выглядят примерно так:
```
// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define('DB_NAME', 'wordpress');

/** MySQL database username */
define('DB_USER', 'wordpressuser');

/** MySQL database password */
define('DB_PASSWORD', 'password');  
```
Это всё, что нам нужно сделать. Когда закончите, сохраните и закройте файл.

### 4. Настройка блока сервера Nginx
Давайте настроим веб-сервер. Для этого создадим стандартный файл конфигурации:
```
touch /etc/nginx/sites-available/wordpress
```
Далее откройте файл конфигурации в текстовом редакторе:
```
sudo nano /etc/nginx/sites-available/wordpress
```
В итоге файл гонфигурации должен выглядеть так:
```
server {  
        listen   80;
        
        #Если файлы WordPress были в другой папке, укажите ее вместо /var/www/wordpress
        root  /var/www/wordpress;
        index index.php index.html index.htm;
        
        #Адрес, по которому вы хотите видеть сайт
        server_name server_domain_name_or_IP;

        location / {
                try_files $uri $uri/ /index.php?q=$uri&$args;
        }

        error_page 404 /404.html;

        error_page 500 502 503 504 /50x.html;
        
        location = /50x.html {
              root /usr/share/nginx/www;
        }

        location ~ \.php$ {
                try_files $uri =404;
                # With php5-fpm:
                fastcgi_pass unix:/var/run/php5-fpm.sock;
                fastcgi_index index.php;
                include fastcgi_params;
        }

}
```
Сохраните и закройте файл.

### 5. Активация блока сервера
После того, как мы выполнили все настройки, нам нужно активировать блок сервера созданием символической ссылки:
```
sudo ln -s /etc/nginx/sites-available/wordpress /etc/nginx/sites-enabled/wordpress
```
Дополнительно, удалим (отключим) стандартный блок сервера:
```
sudo rm /etc/nginx/sites-enabled/default
```
После проведения манипуляций с настройками, необходимо перезагружать сервис Nginx, чтобы изменения вступили в силу:
```
sudo service nginx restart
```
```
sudo service php5-fpm restart
```
### 6. Завершение установки через веб-интерфейс
Теперь, когда все файлы на месте и программное обеспечение настроено, мы можем завершить установку через веб-интерфейс.

Зайдите на свой сайт введя в браузере доменное имя или IP адрес сервера:
```
http://server_domain_name_or_IP
```
Вы увидите начальную страницу конфигурации WordPress, где вам будет предложено ввести название сайта и создать учётную запись администратора:

![](http://speciose.ru/content/images/2015/05/initial_config.png)

Заполните данные и нажмите Install WordPress

WordPress сообщит об удачном завершении установки:

![](http://speciose.ru/content/images/2015/05/confirm_install.png)

Нажмите Log In, чтобы осуществить вход:

![](http://speciose.ru/content/images/2015/05/login.png)

Пройдя аутентификацию, перед вами появится интерфейс WordPress:

![](http://speciose.ru/content/images/2015/05/admin_interface.png)

# **Тонкости при настройке в стеках LAMP и LEMP**
## 1. LEMP
#### 1. Настройка PHP
Откройте главный php5-fpm файл конфигурации с root привилегиями:
```
sudo nano /etc/php5/fpm/php.ini
```
Нам нужно найти параметр cgi.fix_pathinfo. Он будет закомментирован (отключён) символом “точка с запятой” (;) и выставлен на “1” по умолчанию.

Откомментируем строку и зададим значение “0” следующий образом:
```
cgi.fix_pathinfo=0
```
Сохраните и закройте файл, когда закончите редактирвоание.

Теперь нам нужно всего лишь перезапустить сервис PHP, чтобы изменения вступили в силу:
```
sudo service php5-fpm restart
```
#### 2. Настройка Nginx на использование PHP
Откройте конфигурационный файл nginx
```
sudo nano /etc/nginx/nginx.conf
```
Измените поле user на имя вашего пользователя

В настройках сервера должен указываться этот блок:
```
location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
}
```
Текже поле index должно содержать index.php:
```
index index.php index.html index.htm;
```
## 2. LAMP
